<!-- monitor/templates/monitor/index.html -->

<!DOCTYPE html>
<html>
  <head>
    <title>System Monitor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body{
            background-color: black;
            color: white;


        }
        #cpuChart {
            width: 50%;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.02);
        }
    </style>
    <script>
        async function fetchSystemData() {
            try {
                const response = await fetch('/system-data/');
                const data = await response.json();

                // Push the new data into the chart's data array
                cpuChart.data.labels.push(new Date().toLocaleTimeString());
                cpuChart.data.datasets[0].data.push(data.cpu_usage);

                // Make sure we only display a limited number of data points
                const maxDataPoints = 60;
                if (cpuChart.data.labels.length > maxDataPoints) {
                    cpuChart.data.labels.shift();
                    cpuChart.data.datasets[0].data.shift();
                }

                // Update the chart
                cpuChart.update();

                // Update the other system data
                document.getElementById('memory_total').innerText = formatBytes(data.memory_info);
                document.getElementById('memory_used').innerText = formatBytes(data.memory_used);
                document.getElementById('memory_free').innerText = formatBytes(data.memory_info - data.memory_used);
                document.getElementById('memory_percent').innerText = data.memory_percent + '%';
            } catch (error) {
                console.error('Error fetching system data:', error);
            }
        }
      
      function formatBytes(bytes, decimals = 2) {
        if (bytes === 0) return '0 Bytes'
        const k = 1024
        const dm = decimals < 0 ? 0 : decimals
        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB']
        const i = Math.floor(Math.log(bytes) / Math.log(k))
        return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i]
      }
      
      setInterval(fetchSystemData, 1000)
      
      window.onload = fetchSystemData
    </script>
  </head>
  <body>
    <h1>System Resource Monitor</h1>
    {% comment %} <h2>CPU Usage</h2>
    <p id="cpu_usage">{{ cpu_usage }}%</p>

    <h2>Memory Usage</h2>
    <p>
      Total: <span id="memory_total">{{ memory_total }}</span>
    </p>
    <p>
      Used: <span id="memory_used">{{ memory_used|filesizeformat }}</span>
    </p>
    <p>
      Free: <span id="memory_free">{{ memory_free|filesizeformat }}</span>
    </p>
    <p>
      Percentage Used: <span id="memory_percent">{{ memory_percent }}%</span>
    </p> {% endcomment %}
    <canvas id="cpuChart"></canvas>
    <script>
      var ctx = document.getElementById('cpuChart').getContext('2d')
      var cpuChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [], // This will be the timestamps
          datasets: [
            {
              label: 'CPU Usage',
              data: [], // This will be the CPU usage data
              borderColor: 'rgba(75, 192, 192, 1)',

              fill: true,
              {% comment %} tension: 0.1, {% endcomment %}
                backgroundColor: 'rgba(75, 192, 192, 0.4)',
                {% comment %} borderWidth: 1 {% endcomment %}

            }
          ]
        },
        options: {
          scales: {
            y: {
                beginAtZero: true,
                max: 100
            }
          }
        }
      })
    </script>

  </body>
</html>
